<!DOCTYPE html>
<html lang="fa" dir="rtl">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>رهگیری لحظه‌ای مرسولات پست ایران</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='styles.css') }}" />
  </head>
  <body class="app-body">
    <div class="background">
      <div class="orb orb-one"></div>
      <div class="orb orb-two"></div>
      <div class="orb orb-three"></div>
    </div>

    <main class="layout">
      <header class="hero card">
        <div class="hero-content">
          <span class="hero-pill">سرویس هوشمند رهگیری</span>
          <h1>رهگیری سریع و دقیق مرسولات پست ایران</h1>
          <p>
            با وارد کردن کد رهگیری مرسوله، وضعیت لحظه‌ای آن را همراه با جزئیات
            کامل مسیر مشاهده کنید. طراحی این سرویس به صورت کاملاً واکنش‌گرا و
            با انیمیشن‌های پویا انجام شده است تا تجربه‌ای دلنشین داشته باشید.
          </p>
        </div>
        <div class="hero-visual"></div>
      </header>

      <section class="card form-card">
        <form id="tracking-form" method="post" novalidate class="tracking-form">
          <label for="barcode" class="field-label">کد رهگیری مرسوله</label>
          <div class="field-group">
            <input
              type="text"
              id="barcode"
              name="barcode"
              maxlength="30"
              placeholder="مثال: 12345678901234567890"
              value="{{ barcode|default('') }}"
              autocomplete="off"
              required
              inputmode="numeric"
              pattern="[0-9]+"
            />
            <button type="submit" class="primary-button">
              <span>رهگیری مرسوله</span>
              <span class="button-glow" aria-hidden="true"></span>
            </button>
          </div>
          <p class="form-hint">کد رهگیری شما تنها باید شامل اعداد باشد.</p>
        </form>
        <div class="alert-wrapper">
          <div
            class="alert alert-error"
            role="alert"
            data-error
            {% if not error %}hidden{% endif %}
          >
            {{ error }}
          </div>
          <div class="alert alert-success" data-success hidden></div>
        </div>
      </section>

      <section
        class="card results-card"
        data-results
        {% if not result and not error %}hidden{% endif %}
      >
        <div class="results-header">
          <h2>نتایج رهگیری</h2>
          <p class="muted">تمامی اطلاعات به صورت لحظه‌ای از سرویس رسمی پست ایران دریافت می‌شود.</p>
        </div>

        <div class="summary-grid" data-summary>
          {% if result %}
          <div class="summary-item reveal">
            <span class="summary-label">کد رهگیری</span>
            <span class="summary-value">{{ result.barcode }}</span>
          </div>
          {% if result.current_status %}
          <div class="summary-item reveal">
            <span class="summary-label">وضعیت فعلی</span>
            <span class="summary-value">{{ result.current_status }}</span>
          </div>
          {% endif %}
          {% if result.sender %}
          <div class="summary-item reveal">
            <span class="summary-label">فرستنده</span>
            <span class="summary-value">{{ result.sender }}</span>
          </div>
          {% endif %}
          {% if result.receiver %}
          <div class="summary-item reveal">
            <span class="summary-label">گیرنده</span>
            <span class="summary-value">{{ result.receiver }}</span>
          </div>
          {% endif %}
          {% endif %}
        </div>

        <div class="timeline" data-timeline>
          {% if result and result.events %}
          <ol class="timeline-list">
            {% for event in result.events %}
            <li class="timeline-item reveal">
              <div class="timeline-meta">
                <span class="timeline-date">{{ event.date or '-' }}</span>
                <span class="timeline-time">{{ event.time or '-' }}</span>
              </div>
              <div class="timeline-content">
                <h3>{{ event.description }}</h3>
                <p class="muted">{{ event.location or 'مکان نامشخص' }}</p>
              </div>
            </li>
            {% endfor %}
          </ol>
          {% else %}
          <div class="empty-state" data-empty>
            <h3>هنوز اطلاعاتی ثبت نشده است</h3>
            <p>پس از ثبت اولین رویداد برای مرسوله، جزئیات در این بخش نمایش داده می‌شود.</p>
          </div>
          {% endif %}
        </div>

        <details class="raw-response" data-raw {% if not result %}hidden{% endif %}>
          <summary>نمایش پاسخ کامل سرویس</summary>
          <pre>{% if result %}{{ result.raw_response | tojson(indent=2, ensure_ascii=False) }}{% endif %}</pre>
        </details>
      </section>
    </main>

    <div class="loading-overlay" data-loading hidden aria-live="polite" aria-busy="true">
      <div class="spinner"></div>
      <p>در حال دریافت اطلاعات از سرویس پست ایران...</p>
    </div>

    <noscript>
      <div class="noscript-warning">
        برای استفاده از امکانات پویا و انیمیشن‌های پیشرفته، لطفاً جاوااسکریپت را فعال کنید. با این حال سامانه همچنان قابل استفاده است.
      </div>
    </noscript>

    {% if result %}
    <script type="application/json" id="initial-tracking">
      {{ result | tojson(ensure_ascii=False) }}
    </script>
    {% endif %}
    {% if error %}
    <script type="application/json" id="initial-error">
      {{ error | tojson(ensure_ascii=False) }}
    </script>
    {% endif %}
    <script defer src="{{ url_for('static', filename='app.js') }}"></script>
  </body>
</html>
